<div class="container">
  <div class="header">
    <h1>{{ pageTitle }}</h1>
  </div>

  <form class="form-container" [formGroup]="dealForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="title">Deal Title</label>
      <input id="title" type="text" formControlName="title">
      <div *ngIf="dealForm.get('title')?.invalid && dealForm.get('title')?.touched" class="error-message">
        Title is required.
      </div>
    </div> 

    <div class="form-group">
      <label for="value">Value ($)</label>
      <input id="value" type="number" formControlName="value">
      <div *ngIf="dealForm.get('value')?.invalid && dealForm.get('value')?.touched" class="error-message">
        Value must be a positive number.
      </div>
    </div>

    <div class="form-group">
      <label for="closeDate">Close Date</label>
      <input id="closeDate" type="date" formControlName="closeDate">
       <div *ngIf="dealForm.get('closeDate')?.invalid && dealForm.get('closeDate')?.touched" class="error-message">
        Close date is required.
      </div>
    </div>

    <div class="form-group">
      <label for="stage">Stage</label>
      <select id="stage" formControlName="stage">
        <option *ngFor="let stage of dealStages$ | async" [value]="stage">
          {{ stage }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="contactId">Associated Contact</label>
      <select id="contactId" formControlName="contactId">
        <option value="" disabled>Select a contact...</option>
        <option *ngFor="let contact of contacts$ | async" [value]="contact.id">
          {{ contact.firstName }} {{ contact.lastName }}
        </option>
      </select>
      <div *ngIf="dealForm.get('contactId')?.invalid && dealForm.get('contactId')?.touched" class="error-message">
        You must associate this deal with a contact.
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary" [disabled]="dealForm.invalid">Save Deal</button>
      <a class="btn-secondary" routerLink="/deals">Cancel</a>
    </div>
  </form>
</div>